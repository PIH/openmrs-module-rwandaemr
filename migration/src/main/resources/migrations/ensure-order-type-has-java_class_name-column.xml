<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- In 1.10+, All users that created orders(orders.orderer) have provider accounts -->

    <changeSet id="ensure-order-type-has-java_class_name-column" author="IMB">

        <!-- Ensure order_type table has java_class_name and parent columns.  Credit k-joseph
        <changeSet id="imbmigrations-1.10-add-order-type-columns" author="IMB">
            <preConditions onFail="MARK_RAN">
                <not><columnExists tableName="order_type" columnName="java_class_name"/></not>
                <not><columnExists tableName="order_type" columnName="parent"/></not>
            </preConditions>
            <comment>
                Add java_class_name and parent columns to order_type table
            </comment>
            <addColumn tableName="order_type">
                <column name="java_class_name" type="varchar(255)" />
            </addColumn>
            <addColumn tableName="order_type">
                <column name="parent" type="int(11)" />
            </addColumn>
        </changeSet>

        <changeSet id="2016Mar23-1116" author="k-joseph" dbms="mysql">
            <comment>
                Updating java class names under order_type table
            </comment>
            <update tableName="order_type">
                <column name="java_class_name" value="org.openmrs.TestOrder"/>
                <where>name='Lab test'</where>
            </update>
            <update tableName="order_type">
                <column name="java_class_name" value="org.openmrs.DrugOrder"/>
                <where>name='Drug order'</where>
            </update>
            <update tableName="order_type">
                <column name="java_class_name" value="org.openmrs.LunchOrder"/>
                <where>name='Lunch order'</where>
            </update>
        </changeSet>
     -->
        <!--
            TODO: Ensure all existing order types have a valid java_class_name populated
            This should include for drug order, since core will only set this if the uuid of this type is 131168f4-15f5-102d-96e4-000c29c2a5d7, and ours is not
        -->
    </changeSet>

</databaseChangeLog>
