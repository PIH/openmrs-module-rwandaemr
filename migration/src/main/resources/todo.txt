
    <!--

    step  1

        update orders set auto_expire_date=start_date where order_type_id=5 and auto_expire_date is null;

        discontinued orders cannot have null discontinued_date values,

        on my laptop I set this as discontinued_date=start_date where discontinued=1 and discontinued_date is null

        step 2




        check for

        select distinct u.person_id from orders o,users u where o.orderer=u.user_id and u.person_id not in (select person_id from provider);

        if return something then run this

        insert into provider(person_id, identifier, creator, date_created, retired, retired_by, date_retired, retire_reason, uuid)
        select distinct u.person_id, u.system_id, 1, CURRENT_TIMESTAMP, u.retired, u.retired_by, u.date_retired, u.retire_reason, UUID()
        from orders o,users u where o.orderer=u.user_id and u.person_id not in (select person_id from provider);



        ALTER TABLE `order_type`
        ADD COLUMN `java_class_name` VARCHAR(255) DEFAULT NULL,
        ADD COLUMN `parent` INT(11) DEFAULT NULL;


        /usr/share/tomcat6/.OpenMRS$ sudo nano  order_entry_upgrade_settings.txt
    -->

    <!--
        TODO: Ensure all orders have non-null encounter_id
        Set encounter_id to all orders with a start_date but no encounter_id.
        Update orders o join encounter e on o.patient_id=e.patient … see Berchmas documentation
        Then created encounter type “drug order visit”=40
        Update start_date where it is null in the orders table
        then create the encounters for orders that don’t have encounters
     -->

    <!-- TODO: All drugs with a dose_strength specified have the units field set too -->

    <!-- Ensure order_type table has java_class_name and parent columns.  Credit k-joseph
    <changeSet id="imbmigrations-1.10-add-order-type-columns" author="IMB">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="order_type" columnName="java_class_name"/></not>
            <not><columnExists tableName="order_type" columnName="parent"/></not>
        </preConditions>
        <comment>
            Add java_class_name and parent columns to order_type table
        </comment>
        <addColumn tableName="order_type">
            <column name="java_class_name" type="varchar(255)" />
        </addColumn>
        <addColumn tableName="order_type">
            <column name="parent" type="int(11)" />
        </addColumn>
    </changeSet>
 -->

    <!--
        TODO: Ensure all existing order types have a valid java_class_name populated
        This should include for drug order, since core will only set this if the uuid of this type is 131168f4-15f5-102d-96e4-000c29c2a5d7, and ours is not
    -->

    <!-- TODO: All discontinued orders should have the discontinued_date and discontinued_by fields set -->

    <!--
        Only 2 rows seem to have discontinued_date unset that we will need to deal with
        select * from orders where discontinued = 1 and discontinued_date is null and voided = 0;

        For discontinued_by, we will need to decide whether to use the creator or unknown provider
    -->

    <!-- TODO: All users that created orders(orders.orderer) have provider accounts -->

    <!-- TODO: Create an "Unknown Provider" account if it does not already exist -->

    <!-- TODO: Set the global property "provider.unknownProviderUuid" to the uuid of the unknown provider provider -->

    <!--
        TODO:  All existing free text drug order dose units and frequencies have been mapped to concept ids via the order_entry_upgrade_settings.txt file
        ** Import / Create any new concepts needed from CIEL, MOH, PIH.  See Reference_Application_Order_Entry_Concepts-3.zip
        ** Add order_entry_upgrade_settings.txt file to the application data directory (.OpenMRS)
        ** Get unique strings from drug_order.frequency & drug_order.units
        ** Get appropriate concept ids that match each of these after adding them above
        ** Put these in a properties file structured as string=conceptId
        ** Will need to escape characters potentially ( eg. once\ a\ day=65 )
    -->

    <!--
        TODO:  Identify / Create the concept set whose members represent the possible drug dosing units (In CIEL version 1.9.7_20140608 the concept id is: 162384AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (Dose unit))
        ** Set the global property "order.drugDosingUnitsConceptUuid" to the uuid of this
        ** Ensure it contains members for all drug dosing units that are in the order_entry_upgrade_settings.txt file
    -->


    <!--
        TODO: Review remaining below from Singapore notes

    Update autoexpire date= start_date where order_type_id=5 and auto_expire_date is null
        Order_type_id=5 means drug order
        This may have been loosened as a requrement. Or we might want to set it to the year 3000 or something

        If the creator is a provider, set provider to be creator??
    -->


    <!--
        REFERENCE FROM WHAT WAS DONE IN RWANDA RBC UPGRADE MODULE


	<changeSet id="2016Mar23-1116" author="k-joseph" dbms="mysql">
		<comment>
			Updating java class names under order_type table
		</comment>
		<update tableName="order_type">
			<column name="java_class_name" value="org.openmrs.TestOrder"/>
			<where>name='Lab test'</where>
		</update>
		<update tableName="order_type">
			<column name="java_class_name" value="org.openmrs.DrugOrder"/>
			<where>name='Drug order'</where>
		</update>
		<update tableName="order_type">
			<column name="java_class_name" value="org.openmrs.LunchOrder"/>
			<where>name='Lunch order'</where>
		</update>
	</changeSet>





	<changeSet id="2016Mar28-2052" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					<![CDATA[
					SELECT COUNT(*) FROM `drug` WHERE dose_strength IS NOT NULL;
					]]>
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Set units field for all drugs whose dose_strength is specified
		</comment>
		<update tableName="drug">
			<column name="units" value="default"/>
			<where>dose_strength IS NOT NULL</where>
		</update>
	</changeSet>




 	<changeSet id="2016May02-2239" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT COUNT(*) FROM `person` WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c';
				]]>
			</sqlCheck>
		</preConditions>
		<comment>
			Create person for unknown provider
		</comment>
		<sql>
			INSERT INTO `person` (`creator`, `date_created`, `uuid`) VALUES(1, NOW(), '8ea1809e-9b78-11e6-9f33-a24fc0d9649c');
		</sql>
	</changeSet>


 	<changeSet id="2016Mar28-2213" author="k-joseph" dbms="mysql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM `provider` WHERE name = 'Unknown Provider';</sqlCheck>
        </preConditions>
        <comment>Insert Unknown Provider for non set drug orderers</comment>
        <sql>
        	INSERT INTO provider(provider_id, person_id, name, identifier, creator, date_created, retired, uuid)
				SELECT person_id AS provider_id, person_id, 'Unknown Provider', 'unknown', 1, '2016-03-28T22:25:46', 0, '6a7d7d04-f523-11e5-9ce9-5e5517507c66'
					FROM person WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c';
        </sql>
    </changeSet>


	<changeSet id="2016Mar28-2321" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					<![CDATA[
					SELECT COUNT(*) FROM `orders` WHERE orderer IS NULL;
					]]>
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Provide way for OpenMRS to automatically Set orderer to 'Unknown Provider' for all orders without orders;
			Creates and sets provider.unknownProviderUuid GP as required
		</comment>
		<insert tableName="global_property">
			<column name="property" value="provider.unknownProviderUuid" />
            <column name="property_value" value="6a7d7d04-f523-11e5-9ce9-5e5517507c66" />
            <column name="uuid" value="0b665382-f52c-11e5-9ce9-5e5517507c66" />
        </insert>
	</changeSet>
	<changeSet id="2016May03-1735" author="k-joseph">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT COUNT(*) FROM `users` WHERE user_id = (SELECT person_id FROM person WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c');
				]]>
			</sqlCheck>
		</preConditions>
		<comment>
			Add user for unknown user id orderer
		</comment>
        <sql>
        	INSERT INTO users(user_id, person_id, system_id, creator, date_created, retired, uuid)
				SELECT person_id AS user_id, person_id, 'unknown', 1, '2016-03-28T22:25:46', 0, '1d575c76-113d-11e6-a148-3e1d05defe78'
					FROM person WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c';
        </sql>
	</changeSet>


	<changeSet id="2016Mar29-0024" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					<![CDATA[
					SELECT COUNT(*) FROM `orders` WHERE orderer IS NULL;
					]]>
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Set orderer for all unset orders orderers to unknown provider's user
		</comment>
		<sql>
			UPDATE orders o INNER JOIN person AS p ON p.uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c'
				SET o.orderer = p.person_id
				WHERE o.orderer IS NULL;
		</sql>
	</changeSet>


    <changeSet id="2016Mar28-2237" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					<![CDATA[
					SELECT COUNT(*) FROM `orders` WHERE orderer IS NOT NULL;
					]]>
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Create provider accounts for all drug orderers that exist
		</comment>
		<sql>
			INSERT INTO provider (provider_id, person_id, name, identifier, creator, date_created, retired, uuid)
			SELECT DISTINCT u.user_id AS provider_id, u.person_id AS person_id, IFNULL(u.username, u.system_id) AS name, IFNULL(u.username, u.system_id) AS identifier, u.creator, (NOW()) AS date_created, '0' AS retired, (SELECT UUID()) AS uuid FROM users u INNER JOIN orders o ON u.user_id = o.orderer WHERE o.orderer IS NOT NULL AND u.user_id != (SELECT person_id FROM person WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c');
		</sql>
	</changeSet>


	<changeSet id="2016April26-2230" author="k-joseph" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT count(*) FROM encounter_provider WHERE provider_id NOT IN (SELECT DISTINCT provider_id FROM provider);
				]]>
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Bump all non existing encounter providers to un known provider
		</comment>
		<sql>
			UPDATE encounter_provider SET provider_id = (SELECT person_id FROM person WHERE uuid = '8ea1809e-9b78-11e6-9f33-a24fc0d9649c') WHERE provider_id NOT IN (SELECT DISTINCT provider_id FROM provider)
		</sql>
	</changeSet>


    -->
